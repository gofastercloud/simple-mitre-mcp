<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MITRE ATT&CK MCP Explorer</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
        }
        .tool-section {
            margin-bottom: 40px;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 20px;
        }
        .tool-section h2 {
            color: #34495e;
            margin-top: 0;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }
        .advanced-section {
            background-color: #f8f9fa;
            border-left: 4px solid #e74c3c;
        }
        .advanced-section h2 {
            color: #e74c3c;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .advanced-button {
            background-color: #e74c3c;
        }
        .advanced-button:hover {
            background-color: #c0392b;
        }
        .result-area {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 500px;
            overflow-y: auto;
        }
        .array-input {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .array-input input {
            flex: 1;
            margin-right: 10px;
        }
        .array-input button {
            padding: 5px 10px;
            font-size: 12px;
            margin: 0;
        }
        .add-array-item {
            background-color: #27ae60;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 5px;
        }
        .add-array-item:hover {
            background-color: #229954;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è MITRE ATT&CK MCP Explorer</h1>
        
        <!-- Basic Tools Section -->
        <div class="tool-section">
            <h2>üîç Basic Analysis Tools</h2>
            
            <!-- Search Attack Tool -->
            <div class="form-group">
                <label for="search-query">Search MITRE ATT&CK:</label>
                <input type="text" id="search-query" placeholder="Enter search query (e.g., 'phishing', 'T1566', 'APT1')">
                <button onclick="callTool('search_attack', {query: document.getElementById('search-query').value})">Search</button>
            </div>
            
            <!-- Get Technique Tool -->
            <div class="form-group">
                <label for="technique-id">Get Technique Details:</label>
                <input type="text" id="technique-id" placeholder="Enter technique ID (e.g., T1566, T1055)">
                <button onclick="callTool('get_technique', {technique_id: document.getElementById('technique-id').value})">Get Technique</button>
            </div>
            
            <!-- List Tactics Tool -->
            <div class="form-group">
                <button onclick="callTool('list_tactics', {})">List All Tactics</button>
            </div>
            
            <!-- Get Group Techniques Tool -->
            <div class="form-group">
                <label for="group-id">Get Group Techniques:</label>
                <input type="text" id="group-id" placeholder="Enter group ID (e.g., G0016, G0007)">
                <button onclick="callTool('get_group_techniques', {group_id: document.getElementById('group-id').value})">Get Group Techniques</button>
            </div>
            
            <!-- Get Technique Mitigations Tool -->
            <div class="form-group">
                <label for="mitigation-technique-id">Get Technique Mitigations:</label>
                <input type="text" id="mitigation-technique-id" placeholder="Enter technique ID (e.g., T1566, T1055)">
                <button onclick="callTool('get_technique_mitigations', {technique_id: document.getElementById('mitigation-technique-id').value})">Get Mitigations</button>
            </div>
        </div>
        
        <!-- Advanced Tools Section -->
        <div class="tool-section advanced-section">
            <h2>üöÄ Advanced Threat Modeling Tools</h2>
            
            <!-- Build Attack Path Tool -->
            <div class="form-group">
                <label for="start-tactic">Build Attack Path:</label>
                <select id="start-tactic">
                    <option value="TA0001">TA0001 - Initial Access</option>
                    <option value="TA0002">TA0002 - Execution</option>
                    <option value="TA0003">TA0003 - Persistence</option>
                    <option value="TA0004">TA0004 - Privilege Escalation</option>
                    <option value="TA0005">TA0005 - Defense Evasion</option>
                    <option value="TA0006">TA0006 - Credential Access</option>
                    <option value="TA0007">TA0007 - Discovery</option>
                    <option value="TA0008">TA0008 - Lateral Movement</option>
                    <option value="TA0009">TA0009 - Collection</option>
                    <option value="TA0010">TA0010 - Exfiltration</option>
                    <option value="TA0011">TA0011 - Command and Control</option>
                    <option value="TA0040">TA0040 - Impact</option>
                </select>
                <label for="end-tactic">End Tactic:</label>
                <select id="end-tactic">
                    <option value="TA0010">TA0010 - Exfiltration</option>
                    <option value="TA0040">TA0040 - Impact</option>
                    <option value="TA0011">TA0011 - Command and Control</option>
                    <option value="TA0009">TA0009 - Collection</option>
                    <option value="TA0008">TA0008 - Lateral Movement</option>
                    <option value="TA0007">TA0007 - Discovery</option>
                    <option value="TA0006">TA0006 - Credential Access</option>
                    <option value="TA0005">TA0005 - Defense Evasion</option>
                    <option value="TA0004">TA0004 - Privilege Escalation</option>
                    <option value="TA0003">TA0003 - Persistence</option>
                    <option value="TA0002">TA0002 - Execution</option>
                    <option value="TA0001">TA0001 - Initial Access</option>
                </select>
                <label for="path-group-id">Group Filter (optional):</label>
                <input type="text" id="path-group-id" placeholder="Enter group ID (e.g., G0016)">
                <label for="path-platform">Platform Filter (optional):</label>
                <input type="text" id="path-platform" placeholder="Enter platform (e.g., Windows, Linux, macOS)">
                <button class="advanced-button" onclick="buildAttackPath()">Build Attack Path</button>
            </div>
            
            <!-- Analyze Coverage Gaps Tool -->
            <div class="form-group">
                <label>Analyze Coverage Gaps:</label>
                <label for="coverage-groups">Threat Groups (comma-separated):</label>
                <input type="text" id="coverage-groups" placeholder="Enter group IDs (e.g., G0016,G0007,G0032)">
                <label for="coverage-techniques">Specific Techniques (comma-separated, optional):</label>
                <input type="text" id="coverage-techniques" placeholder="Enter technique IDs (e.g., T1566,T1055,T1059)">
                <label for="exclude-mitigations">Exclude Mitigations (comma-separated, optional):</label>
                <input type="text" id="exclude-mitigations" placeholder="Enter mitigation IDs to exclude (e.g., M1049,M1038)">
                <button class="advanced-button" onclick="analyzeCoverageGaps()">Analyze Coverage Gaps</button>
            </div>
            
            <!-- Detect Technique Relationships Tool -->
            <div class="form-group">
                <label for="relationship-technique-id">Detect Technique Relationships:</label>
                <input type="text" id="relationship-technique-id" placeholder="Enter technique ID (e.g., T1055)">
                <label for="relationship-depth">Analysis Depth:</label>
                <select id="relationship-depth">
                    <option value="1">1 - Direct relationships</option>
                    <option value="2" selected>2 - Second-degree relationships</option>
                    <option value="3">3 - Third-degree relationships</option>
                    <option value="4">4 - Fourth-degree relationships</option>
                    <option value="5">5 - Fifth-degree relationships</option>
                </select>
                <label>Relationship Types:</label>
                <div>
                    <input type="checkbox" id="rel-uses" value="uses" checked> <label for="rel-uses">Uses (Attribution)</label><br>
                    <input type="checkbox" id="rel-mitigates" value="mitigates" checked> <label for="rel-mitigates">Mitigates</label><br>
                    <input type="checkbox" id="rel-detects" value="detects"> <label for="rel-detects">Detects</label><br>
                    <input type="checkbox" id="rel-subtechnique" value="subtechnique-of"> <label for="rel-subtechnique">Subtechnique Hierarchy</label><br>
                    <input type="checkbox" id="rel-attributed" value="attributed-to"> <label for="rel-attributed">Attribution</label><br>
                    <input type="checkbox" id="rel-revoked" value="revoked-by"> <label for="rel-revoked">Revoked By</label>
                </div>
                <button class="advanced-button" onclick="detectTechniqueRelationships()">Detect Relationships</button>
            </div>
        </div>
        
        <!-- Results Area -->
        <div class="form-group">
            <label for="results">Results:</label>
            <div id="results" class="result-area">Click a button above to execute a tool and see results here...</div>
        </div>
    </div>

    <script>
        async function callTool(toolName, parameters) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.textContent = 'Executing ' + toolName + '...';
            
            try {
                const response = await fetch('/call_tool', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        tool: toolName,
                        parameters: parameters
                    })
                });
                
                if (!response.ok) {
                    throw new Error('HTTP error! status: ' + response.status);
                }
                
                const result = await response.text();
                resultsDiv.textContent = result;
            } catch (error) {
                resultsDiv.textContent = 'Error: ' + error.message;
            }
        }
        
        function buildAttackPath() {
            const startTactic = document.getElementById('start-tactic').value;
            const endTactic = document.getElementById('end-tactic').value;
            const groupId = document.getElementById('path-group-id').value;
            const platform = document.getElementById('path-platform').value;
            
            const params = {
                start_tactic: startTactic,
                end_tactic: endTactic
            };
            
            if (groupId) params.group_id = groupId;
            if (platform) params.platform = platform;
            
            callTool('build_attack_path', params);
        }
        
        function analyzeCoverageGaps() {
            const groups = document.getElementById('coverage-groups').value;
            const techniques = document.getElementById('coverage-techniques').value;
            const excludeMitigations = document.getElementById('exclude-mitigations').value;
            
            const params = {};
            
            if (groups) {
                params.threat_groups = groups.split(',').map(g => g.trim()).filter(g => g);
            }
            if (techniques) {
                params.technique_list = techniques.split(',').map(t => t.trim()).filter(t => t);
            }
            if (excludeMitigations) {
                params.exclude_mitigations = excludeMitigations.split(',').map(m => m.trim()).filter(m => m);
            }
            
            callTool('analyze_coverage_gaps', params);
        }
        
        function detectTechniqueRelationships() {
            const techniqueId = document.getElementById('relationship-technique-id').value;
            const depth = parseInt(document.getElementById('relationship-depth').value);
            
            const relationshipTypes = [];
            if (document.getElementById('rel-uses').checked) relationshipTypes.push('uses');
            if (document.getElementById('rel-mitigates').checked) relationshipTypes.push('mitigates');
            if (document.getElementById('rel-detects').checked) relationshipTypes.push('detects');
            if (document.getElementById('rel-subtechnique').checked) relationshipTypes.push('subtechnique-of');
            if (document.getElementById('rel-attributed').checked) relationshipTypes.push('attributed-to');
            if (document.getElementById('rel-revoked').checked) relationshipTypes.push('revoked-by');
            
            const params = {
                technique_id: techniqueId,
                depth: depth,
                relationship_types: relationshipTypes
            };
            
            callTool('detect_technique_relationships', params);
        }
    </script>
</body>
</html>
